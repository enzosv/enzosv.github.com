function main(){init();setInterval(theLoop,1e3)}function init(){initTime();images=[];imageCount=prefs.imageCount;var e=true;for(var t=0;t<imageCount;t++){images[t]=new Image;images[t].src=t+1+".jpg";images[t].caption=captions[t]}whiteColor=prefs.whiteColor;createCanvas();resize()}function initTime(){arrivalTime=new Date(prefs.arrivalDate);var e=1/864e5;timeLeft=arrivalTime-(new Date).getTime();e_daysLeft=timeLeft*e;daysLeft=Math.floor(e_daysLeft);e_hoursLeft=(e_daysLeft-daysLeft)*24;hoursLeft=Math.floor(e_hoursLeft);e_minsLeft=(e_hoursLeft-hoursLeft)*60;minsLeft=Math.floor(e_minsLeft);e_secsLeft=(e_minsLeft-minsLeft)*60;secsLeft=Math.floor(e_secsLeft)}function resize(){width=window.innerWidth;height=window.innerHeight;if(height>=width){height=width*40/71}cdWidth=width*.75;cdHeight=height*.2;cdFontSize=cdWidth*cdHeight*prefs.fontMultiplier;setCanvas()}function createCanvas(){cdCanvas=document.createElement("canvas");document.body.appendChild(cdCanvas);labelCanvas=document.createElement("canvas");document.body.appendChild(labelCanvas);sCanvas=document.createElement("canvas");document.body.appendChild(sCanvas);cCanvas=document.createElement("canvas");document.body.appendChild(cCanvas)}function setCanvas(){cdCanvas.width=cdWidth;cdCanvas.height=cdHeight;cdCanvas.style.left=width*.125+"px";cdCanvas.style.top=height*.15+"px";cdCanvas.style.position="absolute";cdCtx=cdCanvas.getContext("2d");cdCtx.fillStyle=whiteColor;cdCtx.font="normal "+cdFontSize+"px Lucida Console";cdCtx.textAlign="center";labelCanvas.width=cdWidth;labelCanvas.height=cdHeight*.5;labelCanvas.style.left=width*.125+"px";labelCanvas.style.top=height*.15-labelCanvas.height+"px";labelCanvas.style.position="absolute";lCtx=labelCanvas.getContext("2d");lCtx.fillStyle=whiteColor;lCtx.font="normal "+cdFontSize*.25+"px Lucida Console";lCtx.textAlign="center";sCanvas.width=cdWidth;sCanvas.height=height*.55;sCanvas.style.left=width*.125+"px";sCanvas.style.top=height*.38+"px";sCanvas.style.position="absolute";sCanvas.style.border="1px solid white";sCtx=sCanvas.getContext("2d");cCanvas.width=cdWidth;cCanvas.height=cdHeight*.3;cCanvas.style.left=width*.125+"px";cCanvas.style.top=height*.93+"px";cCanvas.style.position="absolute";cCanvas.style.border="1px solid white";cCtx=cCanvas.getContext("2d");cCtx.fillStyle=whiteColor;cCtx.font="normal "+cdFontSize*.4+"px Lucida Console";cCtx.textAlign="center";addImage(Math.floor(Math.random()*imageCount));writeLabel()}function writeLabel(){lCtx.fillText("days",labelCanvas.width*.2,labelCanvas.height*.9);lCtx.fillText("hours",labelCanvas.width*.39,labelCanvas.height*.9);lCtx.fillText("mins",labelCanvas.width*.577,labelCanvas.height*.9);lCtx.fillText("secs",labelCanvas.width*.765,labelCanvas.height*.9)}function addImage(e){var t=cdWidth*3;var n=height*.55*3;var r=1;if(images[e].width>t){r=t/images[e].width}else if(images[e].height>n){r=n/images[e].height}images[e].width=width*r;images[e].height=height*r;sCtx.clearRect(0,0,sCanvas.width,sCanvas.height);cCtx.clearRect(0,0,cCanvas.width,cCanvas.height);sCtx.drawImage(images[e],(sCanvas.width-images[e].width)*.5,(sCanvas.height-images[e].height)*.5,images[e].width,images[e].height);if(images[e].caption===undefined){images[e].caption=prefs.defaultCaption}cCtx.fillText(images[e].caption,cCanvas.width*.5,(cCanvas.height+cdFontSize*.2)*.5)}function theLoop(){countdown()}function countdown(){timeLeft=arrivalTime-(new Date).getTime();changeSecs();cdCtx.clearRect(0,0,cdWidth,cdHeight);timer=pad2(daysLeft)+pad2(hoursLeft)+pad2(minsLeft)+pad2(secsLeft);cdCtx.fillText(timer,cdWidth*.5,(cdHeight+cdFontSize)*.4)}function changeSecs(){if(secsLeft===0){secsLeft=60;addImage(Math.floor(Math.random()*imageCount));changeMins()}secsLeft--}function changeMins(){if(minsLeft===0){minsLeft=60;changeHours()}minsLeft--}function changeHours(){if(hoursLeft===0){hoursLeft=24;changeDays()}hoursLeft--}function changeDays(){daysLeft--}function pad2(e){return(e<10?"0":"")+e+" "}function changeDate(){message="New Date:";if(localStorage.getItem("endDate")!=null){message="Change "+localStorage.getItem("endDate")}eDate=prompt("Date:");localStorage.setItem(endDate,Date.parse(eDate))}var cdCanvas;var cdCtx;var lCtx;var sCanvas;var sCtx;var cCanvas;var cCtx;var width;var height;var whiteColor;var cdWidth;var cdHeight;var cdFontSize;var timeLeft;var arrivalTime;var daysLeft;var hoursLeft;var minsLeft;var secsLeft;var images;var imageCount;window.onresize=function(e){cdCtx.clearRect(0,0,cdWidth,cdHeight);lCtx.clearRect(0,0,cdWidth,cdHeight);resize()}