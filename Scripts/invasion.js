function Initialize(){width=window.innerWidth-15;height=window.innerHeight-45;colorWhite="rgb(255,255,255)";colorBlack="rgb(0,0,0)";baseRadius=height*width/3e5;maxEnemies=height/(32*baseRadius);old=getTime();delta=0;images=[];successCount=0;LoadContent()}function LoadContent(){drawCanvas();drawHud();addImage("humanImage");addImage("alienImage");addImage("humanEnemyImage");addImage("alienEnemyImage");addImage("hProj1");addImage("hProj2");addImage("hProj3");addImage("aProj1");addImage("aProj2");addImage("aProj3")}function Demo(){isDemo=!0;gameObjects=[];player1=new Player(findImage("humanImage"),1);player1.aible=!0;player2=new Player(findImage("alienImage"),-1);player2.aible=!0;player1.opponent=player2;player2.opponent=player1;drawStats(player1);drawStats(player2);showDemo()}function showDemo(){delta=getTime()-old;old=getTime();ctx.fillRect(0,0,width,height);for(var e=0;e<gameObjects.length;e++)gameObjects[e].Update();for(e=0;e<gameObjects.length;e++)gameObjects[e].Draw(ctx);!player1.aible||!player2.aible?StartGame():requestAnimFrame(showDemo)}function StartGame(){isDemo=!1;var e=document.getElementById("loading");e&&e.parentNode.removeChild(e);e=document.getElementById("menu");e.parentNode.removeChild(e);gameObjects=[];player1=new Player(findImage("humanImage"),1);player2=new Player(findImage("alienImage"),-1);player1.opponent=player2;player2.opponent=player1;Prepare()}function Prepare(){delta=getTime()-old;old=getTime();ctx.fillRect(0,0,width,height);Update()}function Update(){for(var e=0;e<gameObjects.length;e++)gameObjects[e].Update();Draw()}function Draw(){for(var e=0;e<gameObjects.length;e++)gameObjects[e].Draw(ctx);requestAnimFrame(Prepare)}function vector(e,t){this.x=e;this.y=t;this.add=function(e){this.x+=e.x;this.y+=e.y};this.sub=function(e){this.x-=e.x;this.y-=e.y};this.mul=function(e){this.x*=e;this.y*=e};this.div=function(e){this.x/=e;this.y/=e};this.distance=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))};this.zero=function(){return new vector(0,0)};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.normalize=function(){}}function addImage(e){var t=new Image;t.src="Images/Invasion/"+e+".png";t.name=e;images.push(t);t.addEventListener("load",function(){successCount++;successCount===images.length?updateMenu():updateLoading()},!1)}function findImage(e){for(var t=0;t<images.length;t++)if(images[t].name===e)return images[t];return!1}function drawCanvas(){canvas=document.createElement("canvas");canvas.setAttribute("id","canvas");canvas.setAttribute("style","border: 1px solid white;");canvas.addEventListener("touchstart",touch,!1);canvas.addEventListener("touchmove",function(e){e.preventDefault()},!1);canvas.width=width;canvas.height=height;document.body.appendChild(canvas);ctx=canvas.getContext("2d");ctx.fillRect(0,0,width,height);window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1);window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1)}function touch(e){this.x=e.changedTouches[0].pageX-canvas.offsetLeft;this.x<width/2?(this.y=e.changedTouches[0].pageY-canvas.offsetTop,this.y<player1.center.y?Key.pressed[87]=!0:this.y>player1.center.y?Key.pressed[83]=!0:(delete Key.pressed[87],delete Key.pressed[83])):Key.pressed[68]=!0;canvas.addEventListener("touchend",touchup,!1)}function touchup(e){this.x=e.changedTouches[0].pageX-canvas.offsetLeft;this.x<width/2?(delete Key.pressed[87],delete Key.pressed[83]):this.x>width/2&&(Key.pressed[68]=!1)}function getTime(){return Date.now()}function setHighScores(e){for(var t=1;10>=t;t++)if(localStorage.getItem("invasion"+t)<e){for(var n=prompt(e+"! Enter your name:"),r=10;r>t;r--)localStorage.setItem("invasionN"+r,localStorage.getItem("invasionN"+(r-1))),localStorage.setItem("invasion"+r,localStorage.getItem("invasion"+(r-1)));localStorage.setItem("invasion"+t,e);localStorage.setItem("invasionN"+t,n);break}reviveMenu()}function resetHighScores(){if(confirm("Are you sure?")){for(var e=1;10>=e;e++)localStorage.setItem("invasionN"+e,""),localStorage.setItem("invasion"+e,0);reviveMenu()}}function reviveMenu(){isDemo=hasEnded=!0;var e=document.createElement("canvas");e.id="menu";e.width=200;e.height=200;e.style.border="1px dashed white";e.style.left=width/2-e.width/2+"px";e.style.top=height/2-e.height/2+"px";e.style.position="absolute";document.body.appendChild(e);var t=e.getContext("2d");t.font="normal 16px Lucida Console";t.fillStyle=colorWhite;t.fillText("Charge to Play Again",6,192);for(var n=1;10>=n;n++){10>n?t.fillText(n+" --- "+localStorage.getItem("invasionN"+n),16,16*(n+1)):t.fillText(n+" -- "+localStorage.getItem("invasionN"+n),16,16*(n+1));var r=localStorage.getItem("invasion"+n),i=r;10>r?i="00"+r:100>r&&(i="0"+r);t.fillText(i,e.width-44,16*(n+1))}Demo()}function Player(e,t){gameObjects.push(this);this.image=e;this.number=t;this.radius=10*baseRadius;this.diameter=2*this.radius;this.maxProjectiles=6;this.firing=!0;this.chargeTimer=this.shootTimer=0;this.maxTimer=20;this.score=this.luck=this.power=this.cooldownSpeed=0;this.lvl=1;this.kills=this.exp=0;this.aible=!0;this.weaponKind=0;this.enemyX=width/2;1===this.number?(this.center=new vector(1.5*this.radius,height/2-this.radius),this.projectileImage=findImage("hProj1"),this.projectileImage2=findImage("hProj2"),this.projectileImage3=findImage("hProj3"),this.enemyImage=findImage("alienEnemyImage"),this.projX=this.center.x+this.radius):(this.center=new vector(width-1.5*this.radius,height/2-this.radius),this.projectileImage=findImage("aProj1"),this.projectileImage2=findImage("aProj2"),this.projectileImage3=findImage("aProj3"),this.enemyImage=findImage("humanEnemyImage"),this.projX=this.center.x-this.radius);this.speed=height/1536;this.projectiles=[];this.projectiles2=[];this.projectiles3=[];for(var n=0;n<this.maxProjectiles;n++)this.projectiles[n]=new Projectile(this,this.projX),this.projectiles2[n]=new Projectile(this,this.projX),this.projectiles3[n]=new Projectile(this,this.projX);this.enemies=[];this.enemies[0]=new Enemy(this);this.FindClosest();this.powerups=[]}function Projectile(e,t){gameObjects.push(this);this.owner=e;this.dir=e.number;this.center=new vector(t,0);this.active=!1;this.x=t;this.image=e.projectileImage;this.radius=baseRadius;this.diameter=2*this.radius;this.damageOffset=this.speedOffset=this.originalDamage=this.damage=this.speed=this.level=0;this.LvlUp();this.down=this.up=!1;this.kind=0}function Enemy(e){gameObjects.push(this);this.opponent=e;this.image=e.enemyImage;this.radius=12*baseRadius;this.center=new vector(width/2-this.radius,Math.random()*height);this.direction=-e.number;this.diameter=2*this.radius;this.life=this.maxLife=40;this.speed=width/2e4;this.lvl=1}function Powerup(e,t){gameObjects.push(this);this.image=e;this.center=new vector(0,0);this.radius=5*baseRadius;this.diameter=2*this.radius;this.speed=.1;this.player=t;this.direction=-t.number;this.kind=0}function drawKeyboardInstructions(){var e=document.createElement("canvas");e.width=160;e.height=40;e.style.left="16px";e.style.top=height-32+"px";e.style.position="absolute";e.style.border="1px solid white";document.body.appendChild(e);e=e.getContext("2d");e.font=font;e.fillStyle=colorWhite;e.fillText("Instructions Keyboard:",2,12);e.fillText("Charge: D, Left Arrow",2,24);e.fillText("Move: W, S, Up, Down",2,36)}function drawTouchInstructions(){var e=document.createElement("canvas");e.width=160;e.height=40;e.style.left=width-160+"px";e.style.top=height-32+"px";e.style.position="absolute";e.style.border="1px solid white";document.body.appendChild(e);e=e.getContext("2d");e.font=font;e.fillStyle=colorWhite;e.fillText("Instructions Touch: ",2,12);e.fillText("Charge: Right Half",2,24);e.fillText("Move: Above/Below Half",2,36)}function drawStats(e){var t=document.createElement("canvas");t.id=e.number+"stats";t.width=136;t.height=40;t.style.left=1===e.number?"16px":width-144+"px";t.style.top="32px";t.style.position="absolute";document.body.appendChild(t);t=t.getContext("2d");t.font=font;t.fillStyle=colorWhite;redrawStats(e)}function redrawStats(e){var t=document.getElementById(e.number+"stats").getContext("2d");t.clearRect(0,0,144,40);t.fillText("Score: "+e.score,2,12);t.fillText("Level: "+e.lvl+" Exp: "+Math.floor(e.exp-100*(e.lvl-1)),2,24);t.fillText("Charge: "+e.power,2,36)}function clearBonus(e){document.getElementById(e.number+"bonus").getContext("2d").clearRect(0,0,128,16)}function drawHud(){drawLoading();drawKeyboardInstructions();drawTouchInstructions();drawMenu()}function drawLoading(){var e=document.createElement("canvas");e.id="loading";e.width=230;e.height=20;e.style.left=width/2-e.width/2+"px";e.style.top=height/2-e.height/2+"px";e.style.position="absolute";e.style.border="1px solid white";document.body.appendChild(e);e=e.getContext("2d");e.font=font;e.fillStyle=colorWhite}function updateLoading(){var e=document.getElementById("loading").getContext("2d");e.clearRect(0,0,30,20);e.fillStyle="rgb(255,0,0)";e.fillRect(0,0,30,20);e.fillRect(20*(successCount-1)+30,0,20*successCount,20);e.fillStyle=colorWhite;e.fillText(100*successCount/images.length+"%",2,14);for(var t=0;t<successCount;t++)e.drawImage(images[successCount-1],20*(successCount-1)+35,5,10,10)}function drawMenu(){var e=document.createElement("canvas");e.id="menu";e.width=100;e.height=32;e.style.left=width/2-e.width/2+"px";e.style.top=height/2+e.height/2+"px";e.style.position="absolute";document.body.appendChild(e);e=e.getContext("2d");e.font=font;e.fillStyle=colorWhite;e.fillText("loading..",2,14)}function updateMenu(){updateLoading();var e=document.getElementById("menu"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);t.fillText("Charge to Play",2,12);isDemo=!0;Demo()}var canvas,ctx,width,height,colorWhite,colorBlack,baseRadius,delta,old,images,successCount,gameObjects,player1,player2,maxEnemies,isDemo;var Key={pressed:{},UP:38,DOWN:40,LEFT:37,RIGHT:39,W:87,S:83,A:65,D:68,ESC:27,isDown:function(e){return this.pressed[e]},onKeydown:function(e){this.pressed[e.keyCode]=!0},onKeyup:function(e){delete this.pressed[e.keyCode]}};requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();Player.prototype.GetInput=function(){1===this.number?(Key.isDown(Key.W)?this.direction=-1:Key.isDown(Key.S)?this.direction=1:this.direction=0,Key.isDown(Key.D)?this.firing=!1:this.firing=!0):(Key.isDown(Key.UP)?this.direction=-1:Key.isDown(Key.DOWN)?this.direction=1:this.direction=0,Key.isDown(Key.LEFT)?this.firing=!1:this.firing=!0)};Player.prototype.Move=function(){this.center.y+=this.direction*this.speed*delta};Player.prototype.Charge=function(){0>=this.chargeTimer&&(this.Confirm(),this.chargeTimer=this.maxTimer-this.cooldownSpeed,this.power+=delta,redrawStats(this))};Player.prototype.boundWall=function(){this.canWarp?this.center.y>=height?this.center.y=0:0>this.center.y&&(this.center.y=height):this.center.y+this.radius>=height?this.center.y=height-this.radius:0>this.center.y-this.radius&&(this.center.y=this.radius)};Player.prototype.Shoot=function(){if(0>=this.shootTimer){this.shootTimer=this.maxTimer-this.cooldownSpeed;for(var e=0;e<this.projectiles.length;e++)if(!this.projectiles[e].active&&!this.projectiles2[e].active&&!this.projectiles3[e].active){0<this.power&&(0===this.weaponKind?(this.projectiles[e].damage+=this.power,this.projectiles[e].radius+=this.power/10):1===this.weaponKind?(this.projectiles[e].damage+=this.power/2,this.projectiles[e].radius+=this.power/20,this.projectiles2[e].damage+=this.power/2,this.projectiles2[e].radius+=this.power/20):(this.projectiles[e].damage+=this.power/3,this.projectiles[e].radius+=this.power/30,this.projectiles2[e].damage+=this.power/3,this.projectiles2[e].radius+=this.power/30,this.projectiles3[e].damage+=this.power/3,this.projectiles3[e].radius+=this.power/30),this.power=0,redrawStats(this));0===this.weaponKind?this.projectiles[e].Activate(this.center.y):1===this.weaponKind?(this.projectiles[e].Activate(this.center.y+this.radius/2),this.projectiles2[e].Activate(this.center.y-this.radius/2)):2===this.weaponKind&&(this.projectiles[e].Activate(this.center.y),this.projectiles2[e].Activate(this.center.y),this.projectiles3[e].Activate(this.center.y));break}}};Player.prototype.Cooldown=function(){0<this.shootTimer&&(this.shootTimer-=delta/20);0<this.chargeTimer&&(this.chargeTimer-=delta/20)};Player.prototype.Update=function(){this.aible&&this.Ai();this.GetInput();this.Move();this.firing?this.Shoot():this.Charge();this.boundWall();this.Cooldown()};Player.prototype.Draw=function(){ctx.drawImage(this.image,this.center.x-this.radius,this.center.y-this.radius,this.diameter,this.diameter)};Player.prototype.Ai=function(){this.center.y>this.target.center.y+this.radius?this.center.y-=this.speed*delta:this.center.y<this.target.center.y-this.radius&&(this.center.y+=this.speed*delta)};Player.prototype.FindClosest=function(){for(var e,t=2e3,n=0;n<this.enemies.length;n++){var r=this.center.distance(this.enemies[n].center);r<t&&(e=this.enemies[n],t=r)}this.target=e};Player.prototype.AddScore=function(e){this.score+=e;this.kills++;0==this.kills%10&&this.enemies.length<maxEnemies&&this.enemies.push(new Enemy(this));this.exp+=30*e/this.lvl;this.exp>=100*this.lvl&&this.LvlUp();redrawStats(this)};Player.prototype.LvlUp=function(){this.lvl++;this.speed+=this.speed/100;this.cooldownSpeed+=.02;for(var e=0;e<this.projectiles.length;e++)this.projectiles[e].originalDamage+=this.projectiles[e].damage/10;for(e=0;e<this.opponent.enemies.length;e++)this.opponent.enemies[e].LvlUp();3===this.lvl?(this.powerups[0]=new Powerup(this.projectileImage,this),this.powerups[0].kind=0):5===this.lvl?this.canWarp=!0:10===this.lvl?(this.powerups[1]=new Powerup(this.projectileImage2,this),this.powerups[1].kind=1):15===this.lvl?(this.powerups[2]=new Powerup(this.projectileImage3,this),this.powerups[2].kind=2):15<this.lvl&&(this.luck+=.001)};Player.prototype.MoveSpawnPoint=function(){this.enemyX-=this.number*width/6;this.opponent.aible&&(1===this.number&&this.enemyX>widht/2?this.enemyX=width/2:-1===this.number&&this.enemyX<width/2&&(this.enemyX=width/2));0>=this.enemyX?this.enemyX=width/6:this.enemyX>=width&&(this.enemyX=5*width/6);this.opponent.enemyX=this.enemyX};Player.prototype.Die=function(){this.MoveSpawnPoint();if(!this.aible&&(1===this.number&&this.enemyX<width/6||-1===this.number&&this.enemyX>5*width/6))this.opponent.aible&&setHighScores(this.score);else{this.center.y=height/2-this.radius;this.speed-=this.speed/500;this.cooldownSpeed-=.005;for(var e=0;e<this.projectiles.length;e++)this.projectiles[e].damage-=this.projectiles[e].damage/50;for(e=this.power=0;e<this.maxProjectiles;e++)this.projectiles[e].lvl=0,this.projectiles2[e].lvl=0,this.projectiles3[e].lvl=0;this.ChangeWeapon(0);this.luck=0}};Player.prototype.Confirm=function(){this.aible&&!this.opponent.aible?(delete Key.pressed[Key.LEFT],delete Key.pressed[Key.D],confirm("Multiplayer mode will disable high scores. Are you sure?")&&(this.aible=!1)):this.aible=!1};Player.prototype.ChangeWeapon=function(e){this.weaponKind=e;if(2===this.weaponKind)for(var t=0;t<this.maxProjectiles;t++)this.projectiles2[t].up=!0,this.projectiles3[t].down=!0,this.projectiles[t].Change(e),this.projectiles2[t].Change(e),this.projectiles3[t].Change(e);else for(t=0;t<this.maxProjectiles;t++)this.projectiles2[t].up=!1,this.projectiles3[t].down=!1,this.projectiles[t].Change(e),this.projectiles2[t].Change(e),this.projectiles3[t].Change(e)};Projectile.prototype.Move=function(){this.center.x+=this.dir*this.speed*delta;this.up?this.center.y-=this.speed*delta/3:this.down&&(this.center.y+=this.speed*delta/3)};Projectile.prototype.Activate=function(e){this.active=!0;this.diameter=2*this.radius;this.center.y=e};Projectile.prototype.Deactivate=function(){this.active=!1;this.radius=baseRadius;this.diameter=2*this.radius;this.damage=this.originalDamage;this.center.x=this.x};Projectile.prototype.BoundWall=function(){1===this.dir&&this.center.x+this.radius>width/2?this.Deactivate():-1===this.dir&&this.center.x-this.radius<width/2&&this.Deactivate();this.center.y+this.radius>height?this.Deactivate():0>this.center.y-this.radius&&this.Deactivate()};Projectile.prototype.Collide=function(){for(var e=0;e<this.owner.enemies.length;e++){var t=this.owner.enemies[e];this.center.y>t.center.y-t.radius&&this.center.y<t.center.y+t.radius&&this.center.distance(t.center)<this.radius+t.radius&&(t.GetHit(this.damage),this.Deactivate())}};Projectile.prototype.Update=function(){this.active&&(this.Move(),this.BoundWall(),this.Collide())};Projectile.prototype.Draw=function(){this.active&&ctx.drawImage(this.image,this.center.x-this.radius,this.center.y-this.radius,this.diameter,this.diameter)};Projectile.prototype.LvlUp=function(){this.level++;this.speed=.59+this.level/100+this.speedOffset;this.damage=this.originalDamage=9+this.level+this.damageOffset};Projectile.prototype.Change=function(e){this.kind=e;0===this.kind?(this.damageOffset=this.speedOffset=0,this.image=this.owner.projectileImage):1===this.kind?(this.damageOffset=-5,this.speedOffset=-.15,this.image=this.owner.projectileImage2):2===this.kind&&(this.damageOffset=-7,this.speedOffset=-.3,this.image=this.owner.projectileImage3);this.LvlUp()};Enemy.prototype.Move=function(){this.center.x+=this.direction*this.speed*delta};Enemy.prototype.Collide=function(){if((this.center.y-this.radius<this.opponent.center.y+this.opponent.radius||this.center.y+this.radius>this.opponent.center.y-this.opponent.radius)&&this.center.distance(this.opponent.center)<this.radius+this.opponent.radius)this.opponent.Die(),this.SetPosition()};Enemy.prototype.BoundWall=function(){this.center.y+this.diameter>=height?this.SetPosition():0>this.center.y-this.diameter&&this.SetPosition();this.center.x+this.radius>width?this.SetPosition():0>this.center.x-this.radius&&this.SetPosition()};Enemy.prototype.Update=function(){this.Move();this.BoundWall();this.Collide()};Enemy.prototype.Draw=function(){ctx.drawImage(this.image,this.center.x-this.radius,this.center.y-this.radius,this.diameter,this.diameter)};Enemy.prototype.LvlUp=function(){this.lvl++;this.radius+=this.radius/50;this.diameter=2*this.radius;this.maxLife+=5;this.speed+=this.speed/10};Enemy.prototype.SetPosition=function(){this.center=new vector(this.opponent.enemyX-this.radius,Math.random()*height);this.life=this.maxLife};Enemy.prototype.GetHit=function(e){this.life-=e;0>=this.life&&(this.Drop(),this.SetPosition(),this.opponent.FindClosest(),this.opponent.AddScore(this.lvl))};Enemy.prototype.Drop=function(){var e=Math.random()+this.opponent.luck;.9<e&&this.opponent.powerups[2]&&!this.opponent.powerups[2].active?this.opponent.powerups[2].Activate(this.center):.8<e&&this.opponent.powerups[1]&&!this.opponent.powerups[1].active?this.opponent.powerups[1].Activate(this.center):.7<e&&this.opponent.powerups[0]&&!this.opponent.powerups[0].active&&this.opponent.powerups[0].Activate(this.center)};Powerup.prototype.Move=function(){this.center.x+=this.direction*this.speed*delta};Powerup.prototype.BoundWall=function(){-1===this.direction&&this.center.x+this.radius>width/2?this.active=!1:1===this.direction&&this.center.x-this.radius<width/2&&(this.active=!1)};Powerup.prototype.Collide=function(){if((this.center.y-this.radius<this.player.center.y+this.player.radius||this.center.y+this.radius>this.player.center.y-this.player.radius)&&this.center.distance(this.player.center)<=this.radius+this.player.radius)this.player.ChangeWeapon(this.kind),this.active=!1};Powerup.prototype.Update=function(){this.active&&(this.Move(),this.BoundWall(),this.Collide())};Powerup.prototype.Draw=function(){this.active&&ctx.drawImage(this.image,this.center.x-this.radius,this.center.y-this.radius,this.diameter,this.diameter)};Powerup.prototype.Activate=function(e){this.active=!0;this.center=e};var font="normal 12px Lucida Console";